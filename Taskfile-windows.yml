version: "3"

tasks:
  default:
    cmds:
      - task: test

  setup:
    cmds:
      - task: platform
      - task: game
      - task: test

  platform:
    deps: [nuklear, game]
    cmds:
      - odin build src/main -out:bin/Breakit.exe -debug
    aliases:
      - p
    silent: true
    generates:
      - ./bin/Breakit.exe
    sources:
      - ./**/*.odin

  input:
    deps: [nuklear, game]
    cmds:
      - odin build src/input_debugger -out:bin/input.exe -debug
    aliases:
      - i
    silent: true
    generates:
      - bin/input.exe
    sources:
      - ./src/**/*.odin

  game:
    deps: [test]
    cmds:
      - odin build src/game -build-mode:dll -out:bin/game.dll -debug
    aliases:
      - g
    silent: true
    generates:
      - ./bin/game.dll
    sources:
      - ./src/game/**/*.odin

  test:
    cmds:
      - odin test src/game -out:bin/game_test.exe
      - odin test src/main -out:bin/platform_test.exe
    aliases:
      - t
    method: none
    silent: true
    sources:
      - ./src/**/*.doin

  nuklear:
    cmds:
      - clang -c src/nuklear/nuklear.c -std=c99 -o bin/nuklear.obj -O2
      - llvm-lib bin/nuklear.obj
      - powershell rm bin/nuklear.obj
      - powershell mv bin/nuklear.lib src/nuklear/nuklear_windows_amd64.lib
    sources:
      - ./src/nuklear/**/*.c
      - ./src/nuklear/**/*.h
      - ./src/nuklear/**/*.odin
    generates:
      - src/nuklear/nuklear_windows_amd64.lib
