version: "3"

tasks:
  default:
    cmds:
      - task: test

  setup:
    cmds:
      - task: platform
      - task: game
      - task: test

  platform:
    deps: [game]
    cmds:
      - odin build src -out:bin/Breakit
    aliases:
      - p
    silent: true
    generates:
      - bin/Breakit
    sources:
      - ./src/**/*.odin

  platform_debug:
    deps: [game]
    cmds:
      - odin build src -out:bin/Breakit -debug
    aliases:
      - pd
    silent: true
    generates:
      - bin/Breakit
    sources:
      - ./src/**/*.odin

  game:
    deps: [test]
    cmds:
      - odin build src/game/ -build-mode:dll -out:bin/game.dylib
    aliases:
      - g
    silent: true
    generates:
      - bin/game.dylib
    sources:
      - ./src/game/**/*.odin

  game_debug:
    deps: [test]
    cmds:
      - odin build src/game/ -build-mode:dll -out:bin/game.dylib -debug
    aliases:
      - gd
    silent: true
    generates:
      - bin/game.dylib
    sources:
      - ./src/game/**/*.odin

  test:
    cmds:
      - odin test src/game
      - odin test src
    aliases:
      - t
    method: none
    silent: true
    sources:
      - ./src/**/*.doin
